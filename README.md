# practise
no.1
长列表:
出现的问题：
1、滚动卡顿、闪烁白屏：滚动过程出现卡一下，或者白屏，过一会才出现内容。
2、等待loading：滚动到底部出现loading，过一会儿才可以继续滚动
3、随着滚动逐渐变卡

问题分析：
1、列表元素渲染效率小于滚动速率。
解决方案：通过元素复用的方式，将新建元素改为更新元素，提升渲染效率。

2、数据获取和数据渲染的过程慢。
解决方案：提升数据获取速度和列表渲染效率

3、页面元素增多，内存占用逐渐增多，进而卡顿。
解决方案：
降低页面复杂度，通过回收掉离屏的元素，将页面元素数量稳定在平稳的水平线。
减少内存占用，将离屏的数据回收，降低内存占用。

主要流程设计
1、开始渲染的时候，新增元素。
2、向上或者向下滚动，回收离屏的元素，渲染新数据时，使用回收的元素。

其他
状态托管：解决有状态元素不能复用的问题。
通过增加两个生命周期，在列表元素标记为可复用以及进行复用时，将元素组件内部的状态提升到列表组件中。子组件按照协议实现相应的复用生命周期的函数，由列表组建进行调度。

no.2
弹窗返回拦截
小程序提供了page-container组件，当页面存在此组件时，返回操作只关闭组件，而不退出页面。可以借助该特性进行hook实现手势返回拦截功能。
维护一个页面的弹层栈，返回时候将page-container的show设置为true-》false-》true
一些坑点：
当前页面最多只有一个容器，若已存在容器，无法增加新的容器。（解决方案：若需要多次拦截，多次打开容器来实现，并由组件派发事件）

页面栈中存在多个打开的page-container时会使得页面无法返回
具体方案，hook-leave组件内置加锁逻辑，当前onshow的页面打开page-container前，会关闭onhide页面的page-container，onhide重新onshow时再还原状态。

销毁过的page-container组件使得页面无法滚动
因为会给组件父容器增加fixed定位样式，导致当前页面无法滑动。
解决方案：在页面的wxss中设置（position: static !important;）

规避微信bug，https://developers.weixin.qq.com/community/develop/doc/00006e49368830513d3e53a355b000

https://developers.weixin.qq.com/community/develop/doc/0000e800170a7813649f22e2e53400

no.3
路由预请求
背景：将数据请求提前到页面加载之前，减少页面的渲染时间。
实现：注册预拉取逻辑、触发数据预拉取、目标页面获取预拉取数据

no.4
异常处理
在app.js中的onError中捕获错误，将错误放入队列中，进行上报。

no.5
启动框架将优选app启动过程中的所有任务梳理出来，划分不同优先级并构建任务的依赖关系，将不同优先级任务以不同方式（同步执行或异步+时间片执行）在启动阶段各个生命周期内中性。将各类逻辑从app.js中解耦合，并提高启动时的性能。
外层调度逻辑：分成main、high、medium和low四种优先级，不同优先级的task执行方式不同、对应的生命周期也不同。例如，main、high优先级的任务均同步执行，并且main阶段任务在app.onLaunch阶段执行，high优先级任务在page.onLoad阶段执行；medium和low优先级任务则按异步+时间片执行。
内层task逻辑：需要考虑task的依赖关系以及数据传递。在处理依赖任务时，首先判断依赖任务是否执行过了（采用观察者模式，依赖任务执行完后会发射数据），若执行过了，直接拿数据即可，否则就去调度这个依赖任务。
异步+时间片：设置一个时间片（50ms），在每一次事件循环中分配固定时间片去执行这些task，一旦超过这个时间片，则利用setTimeout推迟到下一个事件循环执行。


1、initExecutor
2、initAFExe

no.6
订单列表页：
订单搜索：增加订单搜索功能，复用原始订单
历史订单折叠：
接入推荐列表
再次购买
订单异步分享
路由预请求

订单详情页：
弹窗返回拦截、压缩屏效、样式优化

个人页、收货地址页
订单轮播
复杂交互，涉及的弹窗比较多。

no.7
性能优化
页面onload到靶点移出屏幕的时间，小于1s的比率即为秒开率。

渲染层加载与执行：减少组件注入个数（用时注入）、减少首屏渲染组件
逻辑层加载与执行：减少setData次数、避免阻塞操作，例如同步读缓存。减少自执行代码。非首屏的逻辑延迟执行。
网络连接：减少DNS解析，使用DNS预解析。
数据获取：路由预拉取、接口聚合、数据缓存
渲染绘制：减少重排重绘、图片预分配占位、渐进式图片


